From d5b42dd2318de32acadaa3c931357635d40860cc Mon Sep 17 00:00:00 2001
From: Martin Schwan <m.schwan@phytec.de>
Date: Mon, 25 May 2020 09:56:30 +0200
Subject: [PATCH sumo-next 1/2] camerabin: Disable cropping when appropriate
 env variable is set

Suggested-by: Enrico Scholz <enrico.scholz@sigma-chemnitz.de>
Signed-off-by: Martin Schwan <m.schwan@phytec.de>
---
 gst/camerabin2/gstwrappercamerabinsrc.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/gst/camerabin2/gstwrappercamerabinsrc.c b/gst/camerabin2/gstwrappercamerabinsrc.c
index c1c6dc5..6912946 100644
--- a/gst/camerabin2/gstwrappercamerabinsrc.c
+++ b/gst/camerabin2/gstwrappercamerabinsrc.c
@@ -540,6 +540,7 @@ gst_wrapper_camera_bin_src_construct_pipeline (GstBaseCameraSrc * bcamsrc)
   GstElement *video_recording_tee;
   gboolean ret = FALSE;
   GstPad *tee_pad;
+  char const *env = g_getenv("GST_CAMERABIN_NO_CROP");
 
   /* checks and adds a new video src if needed */
   if (!check_and_replace_src (self))
@@ -549,6 +550,9 @@ gst_wrapper_camera_bin_src_construct_pipeline (GstBaseCameraSrc * bcamsrc)
 
     GST_DEBUG_OBJECT (self, "constructing pipeline");
 
+    if (env && *env) {
+      /* noop */
+    } else
     if (!(self->src_crop =
             gst_camerabin_create_and_add_element (cbin, "videocrop",
                 "src-crop")))
-- 
2.7.4

